import{C as q,G as f,T as v,B as L,f as A,S as y,A as D,R as N}from"./vendor.6a0bd1d9.js";const G=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&t(h)}).observe(document,{childList:!0,subtree:!0});function e(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerpolicy&&(l.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?l.credentials="include":s.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function t(s){if(s.ep)return;s.ep=!0;const l=e(s);fetch(s.href,l)}};G();class o{constructor(i,e){this.x=i,this.y=e}}function O(r,i,e,t,s){let l=(r-e)*(r-e)+(i-t)*(i-t);return s*=s,l<s}function Q(r,i,e){return O(r.x,r.y,i.x,i.y,e)}function x(r,i){return Math.sqrt(Math.pow(r.x-i.x,2)+Math.pow(r.y-i.y,2))}function U(r){let i=Math.floor(Math.random()*r.length-1)+1;return r[i]}function Y(r){let i=[];for(let e=0;e<r.length;e++)i.push(r[e]);return i}var T=(r=>(r[r.Add=0]="Add",r[r.Remove=1]="Remove",r))(T||{}),d=(r=>(r[r.InGame=0]="InGame",r[r.Pause=1]="Pause",r[r.Won=2]="Won",r[r.Lost=3]="Lost",r))(d||{}),c=(r=>(r[r.Collector=0]="Collector",r[r.Blaster=1]="Blaster",r[r.Stabilizer=2]="Stabilizer",r))(c||{}),u=(r=>(r[r.Idle=0]="Idle",r[r.Moving=1]="Moving",r))(u||{}),p=(r=>(r[r.Health=0]="Health",r[r.Energy=1]="Energy",r))(p||{});const I=class{constructor(r,i,e,t){this.speed=new o(0,0),this.currentTarget=null,this.remove=!1,this.calSpeed=()=>{var a;let s=(a=this.currentTarget)==null?void 0:a.getCenter(),l=new o(s.x-this.pos.x,s.y-this.pos.y),h=x(this.pos,s);this.speed.x=l.x/h*I.baseSpeed,this.speed.y=l.y/h*I.baseSpeed,Math.abs(this.speed.x)>Math.abs(l.x)&&(this.speed.x=l.x),Math.abs(this.speed.y)>Math.abs(l.y)&&(this.speed.y=l.y)},this.move=()=>{this.calSpeed(),this.pos.x+=this.speed.x,this.pos.y+=this.speed.y;let s=this.currentTarget.getCenter();this.pos.x<s.x+.1&&this.pos.x>s.x-.1&&this.pos.y<s.y+.1&&this.pos.y>s.y-.1&&(this.pos.x=s.x,this.pos.y=s.y,this.currentTarget===this.target?(this.remove=!0,this.type===0?(this.target.health++,this.target.healthRequests--,this.target.health>=this.target.maxHealth&&(this.target.health=this.target.maxHealth,this.target.built||(this.target.built=!0,this.target instanceof b&&(this.target.connected=!0,this.game.updateCollectionFields(this.target,T.Add))))):this.type===1&&(this.target.energy+=4,this.target.energyRequests-=4,this.target.energy>this.target.maxEnergy&&(this.target.energy=this.target.maxEnergy))):this.game.findRoute(this))},this.pos=r,this.target=i,this.type=e,this.game=t}};let R=I;R.baseSpeed=.2;const k=class{constructor(r,i){this.moveTargetPos=new o(0,0),this.speed=new o(0,0),this.size=0,this.built=!1,this.maxHealth=0,this.maxEnergy=0,this.healthRequests=0,this.energyRequests=0,this.canMove=!1,this.status=u.Idle,this.getCenter=()=>new o(this.pos.x+this.size/2,this.pos.y+this.size/2),this.requestPacket=()=>{this.maxHealth-this.health-this.healthRequests>0&&this.game.queuePacket(this,p.Health),this.built&&this.maxEnergy-this.energy-this.energyRequests>0&&this.game.queuePacket(this,p.Energy)},this.takeDamage=()=>{for(let e=0;e<this.size;e++)for(let t=0;t<this.size;t++)this.game.world.tiles[this.pos.x+e][this.pos.y+t].creep>0&&(this.health-=this.game.world.tiles[this.pos.x+e][this.pos.y+t].creep/10);this.health<0&&this.game.removeBuilding(this)},this.pos=r,this.health=0,this.energy=0,this.game=i}calSpeed(){if(this.moveTargetPos.x!=this.pos.x||this.moveTargetPos.y!=this.pos.y){let r=new o(this.moveTargetPos.x-this.pos.x,this.moveTargetPos.y-this.pos.y),i=x(this.moveTargetPos,this.pos);this.speed.x=r.x/i*k.baseSpeed,this.speed.y=r.y/i*k.baseSpeed,Math.abs(this.speed.x)>Math.abs(r.x)&&(this.speed.x=r.x),Math.abs(this.speed.y)>Math.abs(r.y)&&(this.speed.y=r.y)}}move(){!this.canMove||this.status!=u.Moving||(this.calSpeed(),this.pos.x+=this.speed.x,this.pos.y+=this.speed.y,this.pos.x<this.moveTargetPos.x+1&&this.pos.x>this.moveTargetPos.x-1&&this.pos.y<this.moveTargetPos.y+1&&this.pos.y>this.moveTargetPos.y-1&&(this.pos.x=this.moveTargetPos.x,this.pos.y=this.moveTargetPos.y,this.status=u.Idle))}};let P=k;P.baseSpeed=.5;class b extends P{constructor(i,e){super(i,e);this.collectedEnergy=0,this.connected=!1,this.maxHealth=5,this.size=1}collectEnergy(){if(this.built){let i=this.game.world.tiles[this.pos.x][this.pos.y].height;for(let e=-2;e<3;e++)for(let t=-2;t<3;t++){let s=new o(this.pos.x+e,this.pos.y+t);if(this.game.world.withinWorld(s.x,s.y)){let l=this.game.world.tiles[s.x][s.y].height;Q(new o(this.pos.x,this.pos.y),new o(s.x,s.y),3)&&l===i&&this.game.world.tiles[s.x][s.y].collector===this&&(this.collectedEnergy+=1)}}}if(this.collectedEnergy>=100){let i=this.game.player.energy+1;this.collectedEnergy-=100,i>this.game.player.maxEnergy&&(i=this.game.player.maxEnergy);let e=new R(this.getCenter(),this.game.player,p.Energy,this.game);e.currentTarget=this,this.game.findRoute(e),e.currentTarget!=null?(this.connected=!0,this.game.player.setEnergy(i)):this.connected=!1}}}class M extends P{constructor(i,e,t){super(new o(i,e),t);this.setEnergy=s=>{let l=document.getElementById("energy-progress");l.innerText=s.toString()+"/"+this.maxEnergy.toString(),l.style.width=(100/this.maxEnergy*s).toString()+"%",this.energy=s},this.health=40,this.maxHealth=40,this.maxEnergy=40,this.setEnergy(10),this.built=!0,this.size=5,this.canMove=!0}}const z=class{constructor(r,i,e){this.speed=new o(0,0),this.remove=!1,this.pos=r,this.targetPos=i,this.rotation=e}calSpeed(){let r=new o(this.targetPos.x-this.pos.x,this.targetPos.y-this.pos.y),i=x(this.pos,this.targetPos);this.speed.x=r.x/i*z.baseSpeed,this.speed.y=r.y/i*z.baseSpeed,Math.abs(this.speed.x)>Math.abs(r.x)&&(this.speed.x=r.x),Math.abs(this.speed.y)>Math.abs(r.y)&&(this.speed.y=r.y)}move(r){this.calSpeed(),this.pos.x+=this.speed.x,this.pos.y+=this.speed.y,this.pos.x<this.targetPos.x+2&&this.pos.x>this.targetPos.x-2&&this.pos.y<this.targetPos.y+2&&this.pos.y>this.targetPos.y-2&&(this.remove=!0,r.world.tiles[this.targetPos.x][this.targetPos.y].creep-=1,r.world.tiles[this.targetPos.x][this.targetPos.y].creep<0&&(r.world.tiles[this.targetPos.x][this.targetPos.y].creep=0))}};let F=z;F.baseSpeed=2;class H extends P{constructor(i,e){super(i,e);this.update=()=>{if(this.energy>0&&this.status==u.Idle){let t=[];for(let s=0;s<this.weaponRadius;s++){for(let l=this.pos.x-s;l<=this.pos.x+s;l++)for(let h=this.pos.y-s;h<=this.pos.y+s;h++)this.game.world.withinWorld(l,h)&&this.game.world.tiles[l][h].creep>0&&t.push(new o(l,h));if(t.length>0)break}if(t.length>0){let s=U(t),l=s.x-this.getCenter().x,h=s.y-this.getCenter().y,a=Math.atan2(l,h);this.energy-=1;let n=new F(this.getCenter(),s,a);this.game.projectiles.add(n)}}},this.maxHealth=5,this.size=1,this.maxEnergy=20,this.weaponRadius=8,this.canMove=!0}}class E extends P{constructor(i,e){super(i,e);this.maxHealth=20,this.built=!0,this.size=1}}class V{constructor(i){this.world=i,this.container=new q}setUp(i,e){const t=new f;for(let s=0;s<this.world.dimensions.x;s++)for(let l=0;l<this.world.dimensions.y;l++){switch(this.world.tiles[s][l].height){case 0:t.beginFill(8154472);break;case 1:t.beginFill(7759975);break;case 2:t.beginFill(10193797);break;case 3:t.beginFill(13611438);break}t.drawRect(i*s,e*l,i,e),t.endFill()}this.container.addChild(t),this.setUpShadow(i,e)}setUpShadow(i,e){const t=new f;for(let s=0;s<this.world.dimensions.x;s++)for(let l=0;l<this.world.dimensions.y;l++){let h=this.world.tiles[s][l].height;t.lineStyle(1,0),this.world.withinWorld(s+1,l)&&h>this.world.tiles[s+1][l].height&&(t.moveTo((s+1)*i+1,l*e),t.lineTo((s+1)*i+1,l*e+e)),this.world.withinWorld(s-1,l)&&h>this.world.tiles[s-1][l].height&&(t.moveTo(s*i-1,l*e),t.lineTo(s*i-1,l*e+e)),this.world.withinWorld(s,l+1)&&h>this.world.tiles[s][l+1].height&&(t.moveTo(s*i,(l+1)*e+1),t.lineTo(s*i+i,(l+1)*e+1)),this.world.withinWorld(s,l-1)&&h>this.world.tiles[s][l-1].height&&(t.moveTo(s*i,l*e-1),t.lineTo(s*i+i,l*e-1)),this.container.addChild(t)}}getTerrain(){return this.container}}var _="/assets/Player.4f15fae1.png",J="/assets/Collector.b9525520.png",X="/assets/Emitter.467b32f7.png",K="/assets/Creeper.7dcb9e99.png",Z="/assets/Blaster.8118f882.png",$="/assets/Stabilizer.c54df0e1.png";const ee=v.from(_),te=v.from(J),se=v.from(X),ie=L.from(K),le=v.from(Z),re=v.from($);class he{constructor(i){var e;this.drawBuildings=(t,s)=>{const l=new A.ColorMatrixFilter;l.grayscale(.3,!1);for(let h of this.game.buildings)if(this.drawHealthBar(t,s,h),this.drawEnergyBar(t,s,h),h instanceof b){const a=new y(te);a.x=h.pos.x*t,a.y=h.pos.y*s,a.width=h.size*t,a.height=h.size*s,a.filters=h.built?[]:[l],this.app.stage.addChild(a)}else if(h instanceof H){const a=new y(le);a.x=h.pos.x*t,a.y=h.pos.y*s,a.filters=h.built?[]:[l],a.width=h.size*t,a.height=h.size*s,this.app.stage.addChild(a)}else if(h instanceof E){const a=new y(re);a.x=h.pos.x*t,a.y=h.pos.y*s,a.filters=h.built?[]:[l],a.width=h.size*t,a.height=h.size*s,this.app.stage.addChild(a)}else if(h instanceof M){const a=new y(ee);a.x=h.pos.x*t,a.y=h.pos.y*s,a.filters=h.built?[]:[l],a.width=h.size*t,a.height=h.size*s,this.app.stage.addChild(a)}else console.log("error cant draw this building")},this.drawHealthBar=(t,s,l)=>{const h=new f;if(l.health<l.maxHealth){let a=l.pos.y*s+s*l.size;h.beginFill(0),h.drawRect(l.pos.x*t,a,t,s/3),h.endFill();let n=t*l.size/l.maxHealth*l.health;h.beginFill(32768),h.drawRect(l.pos.x*t,a,n,s/3),h.endFill()}this.app.stage.addChild(h)},this.drawEnergyBar=(t,s,l)=>{const h=new f;if(!(l instanceof M)){if(l.maxEnergy>0){h.beginFill(0),h.drawRect(l.pos.x*t,l.pos.y*s-s/4,t,s/3),h.endFill();let a=t*l.size/l.maxEnergy*l.energy;h.beginFill(16711680),h.drawRect(l.pos.x*t,l.pos.y*s-s/4,a,s/3)}this.app.stage.addChild(h)}},this.game=i,this.app=new D({view:document.getElementById("canvas"),width:800,height:500,transparent:!0,antialias:!0}),(e=document.getElementById("display"))==null||e.append(this.app.view),this.terrain=new V(i.world),this.terrain.setUp(this.app.renderer.width/this.game.world.dimensions.x,this.app.renderer.height/this.game.world.dimensions.y),this.app.ticker.add(()=>{this.render()})}render(){let i=this.app.renderer.width/this.game.world.dimensions.x,e=this.app.renderer.height/this.game.world.dimensions.y;this.app.stage.addChild(this.terrain.getTerrain()),this.drawCollectionFields(i,e),this.drawEmitter(i,e),this.drawCreeper(i,e),this.drawRoutes(i,e),this.drawBuildings(i,e),this.drawPackets(i,e),this.drawProjectile(i,e)}drawCollectionFields(i,e){var s;const t=new f;for(let l=0;l<this.game.world.dimensions.x;l++)for(let h=0;h<this.game.world.dimensions.y;h++)this.game.world.tiles[l][h].collector&&((s=this.game.world.tiles[l][h].collector)==null?void 0:s.connected)&&(t.beginFill(32768,.3),t.drawRect(i*l,e*h,i,e),t.endFill());this.app.stage.addChild(t)}drawRoutes(i,e){const t=new f;for(let s=0;s<this.game.buildings.length;s++){let l=this.game.buildings[s].getCenter(),h=new o(l.x*i,l.y*e);for(let a=0;a<this.game.buildings.length;a++)if(s!=a&&this.game.buildings[s].status==u.Idle&&this.game.buildings[a].status==u.Idle){let n=this.game.buildings[a].getCenter(),g=new o(n.x*i,n.y*e),m=5;Math.pow(n.x-l.x,2)+Math.pow(n.y-l.y,2)<=Math.pow(m,2)&&(t.beginFill(16777215),t.lineStyle(3,16777215,1),t.moveTo(h.x,h.y),t.lineTo(g.x,g.y),t.closePath(),t.endFill())}}this.app.stage.addChild(t)}drawEmitter(i,e){for(let t of this.game.emitters){const s=new y(se);s.x=t.pos.x*i,s.y=t.pos.y*e,s.width=i,s.height=e,this.app.stage.addChild(s)}}drawCreeper(i,e){for(let s=-this.game.world.dimensions.x;s<=this.game.world.dimensions.x;s++)for(let l=-this.game.world.dimensions.x;l<=this.game.world.dimensions.y;l++)if(this.game.world.withinWorld(s,l)){let h=this.game.world.tiles[s][l].height;for(let a=0;a<9;a++)if(this.game.world.tiles[s][l].creep>a){let n=0,g=0,m=0,w=0;s-1<0?n=0:(this.game.world.tiles[s-1][l].creep>a||this.game.world.tiles[s-1][l].height>h)&&(n=1),s+1>this.game.world.dimensions.x-1?g=0:(this.game.world.tiles[s+1][l].creep>a||this.game.world.tiles[s+1][l].height>h)&&(g=1),l-1<0?m=0:(this.game.world.tiles[s][l-1].creep>a||this.game.world.tiles[s][l-1].height>h)&&(m=1),l+1>this.game.world.dimensions.y-1?w=0:(this.game.world.tiles[s][l+1].creep>a||this.game.world.tiles[s][l+1].height>h)&&(w=1);let S=8*w+4*n+2*m+g;const C=new y(new v(ie,new N(S*16,0,16,16)));C.x=i*s,C.y=e*l,C.width=i,C.height=e,this.app.stage.addChild(C)}}}drawProjectile(i,e){const t=new f;for(let s of this.game.projectiles)t.beginFill(16711680),t.lineStyle(1,16711680),t.moveTo(s.pos.x*i,s.pos.y*e),t.lineTo(s.targetPos.x*i,s.targetPos.y*e),t.closePath(),t.endFill();this.app.stage.addChild(t)}drawPackets(i,e){const t=new f;for(let s of this.game.packets){switch(t.lineStyle(1,4210752),s.type){case p.Health:t.beginFill(8421504);break;case p.Energy:t.beginFill(16711680);break;default:console.log("Error new PacketType");break}t.drawCircle(s.pos.x*i,s.pos.y*e,4),t.endFill()}this.app.stage.addChild(t)}}var W=(r=>(r[r.Null=0]="Null",r[r.Collector=1]="Collector",r[r.Blaster=2]="Blaster",r))(W||{});class ae{constructor(i){var e,t,s,l,h;this.canvasClick=a=>{let n=document.getElementById("canvas"),g=n.clientWidth/this.game.world.dimensions.x,m=n.clientHeight/this.game.world.dimensions.y,w=Math.floor((a.clientX-n.offsetLeft)/g),S=Math.floor((a.clientY-n.offsetTop)/m);this.gameClick(w,S)},this.handleCollectorClick=()=>{this.changeCurser(1)},this.handleBlasterClick=()=>{this.changeCurser(2)},this.pauseBtn=()=>{let a=document.getElementById("pause-btn");this.game.gameState===d.InGame?(this.game.gameState=d.Pause,a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pause" viewBox="0 0 16 16"> <path d="M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z" /> </svg>'):this.game.gameState===d.Pause&&(this.game.gameState=d.InGame,a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play" viewBox="0 0 16 16"> <path d="M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z" /> </svg>')},this.exitBtn=()=>{location.reload()},this.curserState=0,this.game=i,(e=document.getElementById("canvas"))==null||e.addEventListener("click",this.canvasClick),(t=document.getElementById("collector"))==null||t.addEventListener("click",this.handleCollectorClick),(s=document.getElementById("blaster"))==null||s.addEventListener("click",this.handleBlasterClick),(l=document.getElementById("pause-btn"))==null||l.addEventListener("click",this.pauseBtn),(h=document.getElementById("exit-btn"))==null||h.addEventListener("click",this.exitBtn)}gameClick(i,e){switch(this.curserState){case 0:this.selectOrMove({x:i,y:e});break;case 1:console.log("Try to place a Collector at "+i+" "+e),this.game.addBuilding(new o(i,e),c.Collector);break;case 2:console.log("Try to place a Blaster"),this.game.addBuilding(new o(i,e),c.Blaster);break}this.curserState=0}selectOrMove(i){let e=this.game.getBuildingAt(i);e?(console.log("Select building"),this.selectedBuilding=e):this.selectedBuilding?(console.log("Selected Building move"),this.selectedBuilding.status=u.Moving,this.selectedBuilding.moveTargetPos=i,this.selectedBuilding=void 0):console.log("Nothing todo here")}changeCurser(i){console.log("You are holding a "+W[i]),this.curserState=i}}class B{constructor(i,e){this.spawnCreeper=()=>{this.game.world.tiles[this.pos.x][this.pos.y].creep+=this.strength},this.game=e,this.pos=i,this.strength=25}}function ne(){let r=[[2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,3,3,3,3,3,3],[1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,1,1,1,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,3,3,3,3,3,3,3],[1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3],[1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,3,3,3,3,3,3,3,3,3,3],[1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,3,3,3,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,3,3,3,3,3,3,3,3,3,3,3],[1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,3,3,3,3,3,3,3,3,3,3,3,3],[1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3],[1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2],[2,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2],[1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2],[1,1,1,1,1,1,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,1,1,1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2],[1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2],[1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,1,1],[1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,1,1,1],[1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1],[2,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,2,2,2,2,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,2,2,2,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,2,2,2,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,3,3,3,3,2,2,2,2,2,2,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2],[2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1],[3,3,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]];return r.toString=function(){let i=[];for(let e=1;e<48;e++)i.push("["+this[e].join(", ")+"]");return"["+i.join(`,
`)+`
];`},r}class oe{constructor(){this.full=!1,this.collector=null,this.creep=0,this.newcreep=0,this.height=0}}class de{constructor(i){this.getHighestTile=e=>this.tiles[e.x][e.y].height,this.tiles=[],this.dimensions=i}createWorld(){this.tiles=new Array(this.dimensions.x);for(let e=0;e<this.dimensions.x;e++){this.tiles[e]=new Array(this.dimensions.y);for(let t=0;t<this.dimensions.y;t++)this.tiles[e][t]=new oe}let i=ne();for(let e=0;e<this.dimensions.x;e++)for(let t=0;t<this.dimensions.y;t++){let s=i[t][e];s>6&&(s=6),this.tiles[e][t].height=s}}withinWorld(i,e){return i>-1&&i<this.dimensions.x&&e>-1&&e<this.dimensions.y}}class ge{constructor(i){this.update=()=>{this.game.gameState===d.InGame?this.updateCreeper():console.log("not ingame")},this.updateCreeper=()=>{this.emitterCounter++,this.emitterCounter>=20&&(this.spawnInCreeper(),this.emitterCounter=0);for(let e=0;e<this.game.world.dimensions.x;e++)for(let t=0;t<this.game.world.dimensions.y;t++)this.game.world.tiles[e][t].newcreep=this.game.world.tiles[e][t].creep;if(this.creeperCounter++,this.creeperCounter>20){this.creeperCounter-=20;for(let e=0;e<this.game.world.dimensions.x;e++)for(let t=0;t<this.game.world.dimensions.y;t++)e+1<this.game.world.dimensions.x&&this.transferCreep(this.game.world.tiles[e][t],this.game.world.tiles[e+1][t]),e-1>-1&&this.transferCreep(this.game.world.tiles[e][t],this.game.world.tiles[e-1][t]),t+1<this.game.world.dimensions.y&&this.transferCreep(this.game.world.tiles[e][t],this.game.world.tiles[e][t+1]),t-1>-1&&this.transferCreep(this.game.world.tiles[e][t],this.game.world.tiles[e][t-1]);for(let e=0;e<this.game.world.dimensions.x;e++)for(let t=0;t<this.game.world.dimensions.y;t++)this.game.world.tiles[e][t].height+this.game.world.tiles[e][t].newcreep>=6?this.game.world.tiles[e][t].newcreep=6-this.game.world.tiles[e][t].height:this.game.world.tiles[e][t].newcreep<.04&&(this.game.world.tiles[e][t].newcreep=0),this.game.world.tiles[e][t].creep=this.game.world.tiles[e][t].newcreep}},this.transferCreep=(e,t)=>{let s=.2;if(e.height>-1&&t.height>-1&&e.creep>0){let l=e.height+e.creep,h=t.height+t.creep,a=0;if(l>h){a=l-h,a>e.creep&&(a=e.creep);let n=a*s;e.newcreep-=n,t.newcreep+=n}}},this.spawnInCreeper=()=>{for(let e=0;e<this.game.emitters.length;e++)this.game.emitters[e].spawnCreeper()},this.game=i,this.creeperCounter=0,this.emitterCounter=0,setInterval(this.update,1)}}class ce{constructor(i){this.update=()=>{this.game.gameState===d.InGame?this.updateBuildings():console.log("not ingame")},this.updateBuildings=()=>{for(let e=0;e<this.game.buildings.length;e++){const t=this.game.buildings[e];t!==this.game.player&&t.requestPacket(),t instanceof b&&t.collectEnergy(),t instanceof H&&t.update(),t.move(),!(t instanceof E)&&t.status!=u.Moving&&t.takeDamage()}},this.game=i,setInterval(this.update,1e3)}}class pe{constructor(i){this.update=()=>{this.game.gameState===d.InGame?this.moveProjectiles():console.log("not ingame")},this.moveProjectiles=()=>{this.game.projectiles.forEach(e=>{e.remove?this.game.projectiles.delete(e):e.move(this.game)})},this.game=i,setInterval(this.update,100)}}class me{constructor(i){this.update=()=>{this.game.gameState===d.InGame?this.movePackets():console.log("not ingame")},this.movePackets=()=>{this.game.packets.forEach(e=>{e.remove?this.game.packets.delete(e):e.move()})},this.game=i,setInterval(this.update,200)}}class j{constructor(){this.nodes=[],this.remove=!1,this.distanceTravelled=0,this.distanceRemaining=0}}class ue{constructor(i){this.update=()=>{this.game.gameState===d.InGame?this.sendPackets():console.log("not ingame")},this.sendPackets=()=>{for(let e=0;e<this.game.packetQueue.length;e++)if(this.game.player.energy>0){this.game.player.setEnergy(this.game.player.energy-1);let t=this.game.packetQueue.shift();t!==void 0&&this.game.packets.add(t)}},this.game=i,setInterval(this.update,100)}}class fe{constructor(i){this.update=()=>{let e=!0;for(let t=0;t<this.game.buildings.length;t++)this.game.buildings[t]instanceof E&&this.game.buildings[t].health!==this.game.buildings[t].maxHealth&&(e=!1);e&&(this.game.gameState=d.Won,console.log("You have won the game")),this.game.player.health===0&&(this.game.gameState=d.Lost,console.log("You have lost the game"))},this.game=i,setInterval(this.update,1)}}class we{constructor(){this.buildings=[],this.emitters=[],this.projectiles=new Set,this.packets=new Set,this.packetQueue=[],this.stabilizer=[],this.removeBuilding=i=>{this.buildings=this.buildings.filter(e=>e!==i),this.updateConnections(),i instanceof b&&i.built&&this.updateCollectionFields(i,T.Remove),this.packets.forEach(e=>{e.target===i&&this.packets.delete(e)}),this.packetQueue=this.packetQueue.filter(e=>e.target!==i)},this.findRoute=i=>{let e=[],t=new j;for(t.nodes.push(i.currentTarget),e.push(t);e.length>0&&e[0].nodes[e[0].nodes.length-1]!==i.target;){let s=e.shift(),l=s==null?void 0:s.nodes[s.nodes.length-1],h=this.getNeighbourBuildings(l,i.target);for(let a=0;a<h.length;a++)if(!this.inRoute(h[a],s==null?void 0:s.nodes)){let n=new j;n.nodes=Y(s==null?void 0:s.nodes),n.nodes.push(h[a]),n.distanceTravelled=s==null?void 0:s.distanceTravelled;let g=n.nodes[n.nodes.length-1].getCenter(),m=n.nodes[n.nodes.length-2].getCenter();n.distanceTravelled+=x(g,m);let w=i.target.getCenter();n.distanceRemaining=x(w,g),e.push(n)}for(let a=0;a<e.length;a++)for(let n=0;n<e.length;n++)a!==n&&e[a].nodes[e[a].nodes.length-1]===e[n].nodes[e[n].nodes.length-1]&&(e[a].distanceTravelled<e[n].distanceTravelled?e[n].remove=!0:e[a].distanceTravelled>e[n].distanceTravelled&&(e[a].remove=!0));for(let a=0;a<e.length;a++)e[a].remove&&e.splice(a,1);e.sort((a,n)=>a.distanceTravelled+a.distanceRemaining-(n.distanceTravelled+n.distanceRemaining))}e.length>0?i.currentTarget=e[0].nodes[1]:(i.currentTarget=null,i.type===p.Energy?(i.target.energyRequests--,i.target.energyRequests<0&&(i.target.energyRequests=0)):i.type===p.Health&&(i.target.healthRequests--,i.target.healthRequests<0&&(i.target.healthRequests=0)),i.remove=!0)},this.inRoute=(i,e)=>{let t=!1;for(let s=0;s<e.length;s++)if(i.pos.x===e[s].pos.x&&i.pos.y===e[s].pos.y){t=!0;break}return t},this.getBuildingAt=i=>{for(let e=0;e<this.buildings.length;e++){const t=this.buildings[e];if(i.x>=t.pos.x&&i.y>=t.pos.y&&i.x<t.pos.x+t.size&&i.y<t.pos.y+t.size)return t}},this.player=new M(40,36,this),this.world=new de({x:70,y:48}),this.world.createWorld(),this.emitters.push(new B(new o(0,0),this)),this.emitters.push(new B(new o(17,0),this)),this.emitters.push(new B(new o(35,0),this)),this.emitters.push(new B(new o(69,0),this)),this.buildings.push(this.player),this.addBuilding(new o(42,29),c.Collector),this.buildings[1].built=!0,this.buildings[1].health=this.buildings[1].maxHealth,this.addBuilding(new o(9,5),c.Stabilizer),this.addBuilding(new o(37,4),c.Stabilizer),this.addBuilding(new o(59,17),c.Stabilizer),this.gameState=d.InGame,new fe(this),new ge(this),new ce(this),new pe(this),new ue(this),new me(this)}addBuilding(i,e){let t=null;if(!this.buildingCanBePlaced(i)){console.log("building cant be placed");return}switch(e){case c.Collector:t=new b(i,this);break;case c.Blaster:t=new H(i,this);break;case c.Stabilizer:t=new E(i,this);break}t!==null&&(this.buildings.push(t),this.updateConnections(),console.log("new building has been placed at: "+i.x+" "+i.y))}getNeighbourBuildings(i,e){let t=[];for(let s=0;s<this.buildings.length;s++)if(!(i.pos.x===this.buildings[s].pos.x&&i.pos.y===this.buildings[s].pos.y)&&(this.buildings[s]===e||this.buildings[s].built||e===void 0)){let l=this.buildings[s].getCenter(),h=i.getCenter();x(h,l)<=5&&t.push(this.buildings[s])}return t}updateConnections(){let i=[];this.getAllConnections(this.player,i);for(let e=0;e<i.length;e++){const t=i[e];t instanceof b&&t.built&&this.updateCollectionFields(t,T.Add)}}getAllConnections(i,e){let t=this.getNeighbourBuildings(i);for(let s=0;s<t.length;s++)e.includes(t[s])||(e.push(t[s]),this.getAllConnections(t[s],e))}updateCollectionFields(i,e){let t=this.world.tiles[i.pos.x][i.pos.y].height;for(let s=-2;s<3;s++)for(let l=-2;l<3;l++){const h=new o(i.pos.x+s,i.pos.y+l);if(this.world.withinWorld(h.x,h.y)){const a=this.world.tiles[h.x][h.y].height;t===a&&(e===T.Add?this.world.tiles[h.x][h.y].collector=i:this.world.tiles[h.x][h.y].collector=null)}}}queuePacket(i,e){let t=new R(this.player.getCenter(),i,e,this);t.currentTarget=this.player,this.findRoute(t),t.currentTarget!==null&&(e===p.Health&&i.healthRequests++,e===p.Energy&&(i.energyRequests+=4),this.packetQueue.push(t))}buildingCanBePlaced(i){for(let e=0;e<this.buildings.length;e++){const t=this.buildings[e];if(i.x>=t.pos.x&&i.y>=t.pos.y&&i.x<t.pos.x+t.size&&i.y<t.pos.y+t.size)return!1}return!0}}class ye{constructor(i){var e;this.hover=t=>{let s=document.getElementById("canvas"),l=s.clientWidth/this.game.world.dimensions.x,h=s.clientHeight/this.game.world.dimensions.y,a=Math.floor((t.clientX-s.offsetLeft)/l),n=Math.floor((t.clientY-s.offsetTop)/h);this.updateProgressbar(new o(a,n))},this.updateProgressbar=t=>{let s=document.getElementById("elevation-terrain-progress"),l=this.game.world.tiles[t.x][t.y].height;s.style.width=(100/6*l).toString()+"%",s=document.getElementById("elevation-creeper-progress");let h=this.game.world.tiles[t.x][t.y].creep;s.style.width=(100/6*h).toString()+"%"},this.game=i,(e=document.getElementById("canvas"))==null||e.addEventListener("mousemove",this.hover)}}class xe{constructor(){this.offset={x:0,y:0},this.game=new we,this.clickHandler=new ae(this.game),new ye(this.game),new he(this.game)}onClick(i){this.clickHandler.changeCurser(i)}}new xe;

import{C as q,G as f,T as v,B as L,f as A,S as y,A as D,R as N}from"./vendor.6a0bd1d9.js";const G=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&t(h)}).observe(document,{childList:!0,subtree:!0});function e(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerpolicy&&(l.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?l.credentials="include":i.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function t(i){if(i.ep)return;i.ep=!0;const l=e(i);fetch(i.href,l)}};G();class o{constructor(s,e){this.x=s,this.y=e}}function O(r,s,e,t,i){let l=(r-e)*(r-e)+(s-t)*(s-t);return i*=i,l<i}function Q(r,s,e){return O(r.x,r.y,s.x,s.y,e)}function x(r,s){return Math.sqrt(Math.pow(r.x-s.x,2)+Math.pow(r.y-s.y,2))}function U(r){let s=Math.floor(Math.random()*r.length-1)+1;return r[s]}function Y(r){let s=[];for(let e=0;e<r.length;e++)s.push(r[e]);return s}var T=(r=>(r[r.Add=0]="Add",r[r.Remove=1]="Remove",r))(T||{}),d=(r=>(r[r.InGame=0]="InGame",r[r.Pause=1]="Pause",r[r.Won=2]="Won",r[r.Lost=3]="Lost",r))(d||{}),c=(r=>(r[r.Collector=0]="Collector",r[r.Blaster=1]="Blaster",r[r.Stabilizer=2]="Stabilizer",r))(c||{}),u=(r=>(r[r.Idle=0]="Idle",r[r.Moving=1]="Moving",r))(u||{}),p=(r=>(r[r.Health=0]="Health",r[r.Energy=1]="Energy",r))(p||{});const k=class{constructor(r,s,e,t){this.speed=new o(0,0),this.currentTarget=null,this.remove=!1,this.calSpeed=()=>{var n;let i=(n=this.currentTarget)==null?void 0:n.getCenter(),l=new o(i.x-this.pos.x,i.y-this.pos.y),h=x(this.pos,i);this.speed.x=l.x/h*k.baseSpeed,this.speed.y=l.y/h*k.baseSpeed,Math.abs(this.speed.x)>Math.abs(l.x)&&(this.speed.x=l.x),Math.abs(this.speed.y)>Math.abs(l.y)&&(this.speed.y=l.y)},this.move=()=>{this.calSpeed(),this.pos.x+=this.speed.x,this.pos.y+=this.speed.y;let i=this.currentTarget.getCenter();this.pos.x<i.x+.1&&this.pos.x>i.x-.1&&this.pos.y<i.y+.1&&this.pos.y>i.y-.1&&(this.pos.x=i.x,this.pos.y=i.y,this.currentTarget===this.target?(this.remove=!0,this.type===0?(this.target.health++,this.target.healthRequests--,this.target.health>=this.target.maxHealth&&(this.target.health=this.target.maxHealth,this.target.built||(this.target.built=!0,this.target instanceof b&&(this.target.connected=!0,this.game.updateCollectionFields(this.target,T.Add))))):this.type===1&&(this.target.energy+=4,this.target.energyRequests-=4,this.target.energy>this.target.maxEnergy&&(this.target.energy=this.target.maxEnergy))):this.game.findRoute(this))},this.pos=r,this.target=s,this.type=e,this.game=t}};let R=k;R.baseSpeed=.2;const I=class{constructor(r,s){this.moveTargetPos=new o(0,0),this.speed=new o(0,0),this.size=0,this.built=!1,this.maxHealth=0,this.maxEnergy=0,this.healthRequests=0,this.energyRequests=0,this.canMove=!1,this.status=u.Idle,this.getCenter=()=>new o(this.pos.x+this.size/2,this.pos.y+this.size/2),this.requestPacket=()=>{this.maxHealth-this.health-this.healthRequests>0&&this.game.queuePacket(this,p.Health),this.built&&this.maxEnergy-this.energy-this.energyRequests>0&&this.game.queuePacket(this,p.Energy)},this.takeDamage=()=>{for(let e=0;e<this.size;e++)for(let t=0;t<this.size;t++)this.game.world.tiles[this.pos.x+e][this.pos.y+t].creep>0&&(this.health-=this.game.world.tiles[this.pos.x+e][this.pos.y+t].creep/10);this.health<0&&this.game.removeBuilding(this)},this.pos=r,this.health=0,this.energy=0,this.game=s}calSpeed(){if(this.moveTargetPos.x!=this.pos.x||this.moveTargetPos.y!=this.pos.y){let r=new o(this.moveTargetPos.x-this.pos.x,this.moveTargetPos.y-this.pos.y),s=x(this.moveTargetPos,this.pos);this.speed.x=r.x/s*I.baseSpeed,this.speed.y=r.y/s*I.baseSpeed,Math.abs(this.speed.x)>Math.abs(r.x)&&(this.speed.x=r.x),Math.abs(this.speed.y)>Math.abs(r.y)&&(this.speed.y=r.y)}}move(){!this.canMove||this.status!=u.Moving||(this.calSpeed(),this.pos.x+=this.speed.x,this.pos.y+=this.speed.y,this.pos.x<this.moveTargetPos.x+1&&this.pos.x>this.moveTargetPos.x-1&&this.pos.y<this.moveTargetPos.y+1&&this.pos.y>this.moveTargetPos.y-1&&(this.pos.x=this.moveTargetPos.x,this.pos.y=this.moveTargetPos.y,this.status=u.Idle))}};let P=I;P.baseSpeed=.5;class b extends P{constructor(s,e){super(s,e);this.collectedEnergy=0,this.connected=!1,this.maxHealth=5,this.size=1}collectEnergy(){if(this.built){let s=this.game.world.tiles[this.pos.x][this.pos.y].height;for(let e=-2;e<3;e++)for(let t=-2;t<3;t++){let i=new o(this.pos.x+e,this.pos.y+t);if(this.game.world.withinWorld(i.x,i.y)){let l=this.game.world.tiles[i.x][i.y].height;Q(new o(this.pos.x,this.pos.y),new o(i.x,i.y),3)&&l===s&&this.game.world.tiles[i.x][i.y].collector===this&&(this.collectedEnergy+=1)}}}if(this.collectedEnergy>=100){let s=this.game.player.energy+1;this.collectedEnergy-=100,s>this.game.player.maxEnergy&&(s=this.game.player.maxEnergy);let e=new R(this.getCenter(),this.game.player,p.Energy,this.game);e.currentTarget=this,this.game.findRoute(e),e.currentTarget!=null?(this.connected=!0,this.game.player.setEnergy(s)):this.connected=!1}}}class M extends P{constructor(s,e,t){super(new o(s,e),t);this.setEnergy=i=>{let l=document.getElementById("energy-progress");l.innerText=i.toString()+"/"+this.maxEnergy.toString(),l.style.width=(100/this.maxEnergy*i).toString()+"%",this.energy=i},this.health=40,this.maxHealth=40,this.maxEnergy=40,this.setEnergy(10),this.built=!0,this.size=5,this.canMove=!0}}const z=class{constructor(r,s,e){this.speed=new o(0,0),this.remove=!1,this.pos=r,this.targetPos=s,this.rotation=e}calSpeed(){let r=new o(this.targetPos.x-this.pos.x,this.targetPos.y-this.pos.y),s=x(this.pos,this.targetPos);this.speed.x=r.x/s*z.baseSpeed,this.speed.y=r.y/s*z.baseSpeed,Math.abs(this.speed.x)>Math.abs(r.x)&&(this.speed.x=r.x),Math.abs(this.speed.y)>Math.abs(r.y)&&(this.speed.y=r.y)}move(r){this.calSpeed(),this.pos.x+=this.speed.x,this.pos.y+=this.speed.y,this.pos.x<this.targetPos.x+2&&this.pos.x>this.targetPos.x-2&&this.pos.y<this.targetPos.y+2&&this.pos.y>this.targetPos.y-2&&(this.remove=!0,r.world.tiles[this.targetPos.x][this.targetPos.y].creep-=1,r.world.tiles[this.targetPos.x][this.targetPos.y].creep<0&&(r.world.tiles[this.targetPos.x][this.targetPos.y].creep=0))}};let F=z;F.baseSpeed=2;class H extends P{constructor(s,e){super(s,e);this.update=()=>{if(this.energy>0&&this.status==u.Idle){let t=[];for(let i=0;i<this.weaponRadius;i++){for(let l=this.pos.x-i;l<=this.pos.x+i;l++)for(let h=this.pos.y-i;h<=this.pos.y+i;h++)this.game.world.withinWorld(l,h)&&this.game.world.tiles[l][h].creep>0&&t.push(new o(l,h));if(t.length>0)break}if(t.length>0){let i=U(t),l=i.x-this.getCenter().x,h=i.y-this.getCenter().y,n=Math.atan2(l,h);this.energy-=1;let a=new F(this.getCenter(),i,n);this.game.projectiles.add(a)}}},this.maxHealth=5,this.size=1,this.maxEnergy=20,this.weaponRadius=8,this.canMove=!0}}class E extends P{constructor(s,e){super(s,e);this.maxHealth=20,this.built=!0,this.size=1}}class V{constructor(s){this.world=s,this.container=new q}setUp(s,e){const t=new f;for(let i=0;i<this.world.dimensions.x;i++)for(let l=0;l<this.world.dimensions.y;l++){switch(this.world.tiles[i][l].height){case 0:t.beginFill(8154472);break;case 1:t.beginFill(7759975);break;case 2:t.beginFill(10193797);break;case 3:t.beginFill(13611438);break}t.drawRect(s*i,e*l,s,e),t.endFill()}this.container.addChild(t),this.setUpShadow(s,e)}setUpShadow(s,e){const t=new f;for(let i=0;i<this.world.dimensions.x;i++)for(let l=0;l<this.world.dimensions.y;l++){let h=this.world.tiles[i][l].height;t.lineStyle(1,0),this.world.withinWorld(i+1,l)&&h>this.world.tiles[i+1][l].height&&(t.moveTo((i+1)*s+1,l*e),t.lineTo((i+1)*s+1,l*e+e)),this.world.withinWorld(i-1,l)&&h>this.world.tiles[i-1][l].height&&(t.moveTo(i*s-1,l*e),t.lineTo(i*s-1,l*e+e)),this.world.withinWorld(i,l+1)&&h>this.world.tiles[i][l+1].height&&(t.moveTo(i*s,(l+1)*e+1),t.lineTo(i*s+s,(l+1)*e+1)),this.world.withinWorld(i,l-1)&&h>this.world.tiles[i][l-1].height&&(t.moveTo(i*s,l*e-1),t.lineTo(i*s+s,l*e-1)),this.container.addChild(t)}}getTerrain(){return this.container}}const _=v.from("/img/Player.png"),J=v.from("/img/Collector.png"),X=v.from("/img/Emitter.png"),K=L.from("/img/Creeper.png"),Z=v.from("/img/Blaster.png"),$=v.from("/img/Stabilizer.png");class ee{constructor(s){var e;this.drawBuildings=(t,i)=>{const l=new A.ColorMatrixFilter;l.grayscale(.3,!1);for(let h of this.game.buildings)if(this.drawHealthBar(t,i,h),this.drawEnergyBar(t,i,h),h instanceof b){const n=new y(J);n.x=h.pos.x*t,n.y=h.pos.y*i,n.width=h.size*t,n.height=h.size*i,n.filters=h.built?[]:[l],this.app.stage.addChild(n)}else if(h instanceof H){const n=new y(Z);n.x=h.pos.x*t,n.y=h.pos.y*i,n.filters=h.built?[]:[l],n.width=h.size*t,n.height=h.size*i,this.app.stage.addChild(n)}else if(h instanceof E){const n=new y($);n.x=h.pos.x*t,n.y=h.pos.y*i,n.filters=h.built?[]:[l],n.width=h.size*t,n.height=h.size*i,this.app.stage.addChild(n)}else if(h instanceof M){const n=new y(_);n.x=h.pos.x*t,n.y=h.pos.y*i,n.filters=h.built?[]:[l],n.width=h.size*t,n.height=h.size*i,this.app.stage.addChild(n)}else console.log("error cant draw this building")},this.drawHealthBar=(t,i,l)=>{const h=new f;if(l.health<l.maxHealth){let n=l.pos.y*i+i*l.size;h.beginFill(0),h.drawRect(l.pos.x*t,n,t,i/3),h.endFill();let a=t*l.size/l.maxHealth*l.health;h.beginFill(32768),h.drawRect(l.pos.x*t,n,a,i/3),h.endFill()}this.app.stage.addChild(h)},this.drawEnergyBar=(t,i,l)=>{const h=new f;if(!(l instanceof M)){if(l.maxEnergy>0){h.beginFill(0),h.drawRect(l.pos.x*t,l.pos.y*i-i/4,t,i/3),h.endFill();let n=t*l.size/l.maxEnergy*l.energy;h.beginFill(16711680),h.drawRect(l.pos.x*t,l.pos.y*i-i/4,n,i/3)}this.app.stage.addChild(h)}},this.game=s,this.app=new D({view:document.getElementById("canvas"),width:800,height:500,transparent:!0,antialias:!0}),(e=document.getElementById("display"))==null||e.append(this.app.view),this.terrain=new V(s.world),this.terrain.setUp(this.app.renderer.width/this.game.world.dimensions.x,this.app.renderer.height/this.game.world.dimensions.y),this.app.ticker.add(()=>{this.render()})}render(){let s=this.app.renderer.width/this.game.world.dimensions.x,e=this.app.renderer.height/this.game.world.dimensions.y;this.app.stage.addChild(this.terrain.getTerrain()),this.drawCollectionFields(s,e),this.drawEmitter(s,e),this.drawCreeper(s,e),this.drawRoutes(s,e),this.drawBuildings(s,e),this.drawPackets(s,e),this.drawProjectile(s,e)}drawCollectionFields(s,e){var i;const t=new f;for(let l=0;l<this.game.world.dimensions.x;l++)for(let h=0;h<this.game.world.dimensions.y;h++)this.game.world.tiles[l][h].collector&&((i=this.game.world.tiles[l][h].collector)==null?void 0:i.connected)&&(t.beginFill(32768,.3),t.drawRect(s*l,e*h,s,e),t.endFill());this.app.stage.addChild(t)}drawRoutes(s,e){const t=new f;for(let i=0;i<this.game.buildings.length;i++){let l=this.game.buildings[i].getCenter(),h=new o(l.x*s,l.y*e);for(let n=0;n<this.game.buildings.length;n++)if(i!=n&&this.game.buildings[i].status==u.Idle&&this.game.buildings[n].status==u.Idle){let a=this.game.buildings[n].getCenter(),g=new o(a.x*s,a.y*e),m=5;Math.pow(a.x-l.x,2)+Math.pow(a.y-l.y,2)<=Math.pow(m,2)&&(t.beginFill(16777215),t.lineStyle(3,16777215,1),t.moveTo(h.x,h.y),t.lineTo(g.x,g.y),t.closePath(),t.endFill())}}this.app.stage.addChild(t)}drawEmitter(s,e){for(let t of this.game.emitters){const i=new y(X);i.x=t.pos.x*s,i.y=t.pos.y*e,i.width=s,i.height=e,this.app.stage.addChild(i)}}drawCreeper(s,e){for(let i=-this.game.world.dimensions.x;i<=this.game.world.dimensions.x;i++)for(let l=-this.game.world.dimensions.x;l<=this.game.world.dimensions.y;l++)if(this.game.world.withinWorld(i,l)){let h=this.game.world.tiles[i][l].height;for(let n=0;n<9;n++)if(this.game.world.tiles[i][l].creep>n){let a=0,g=0,m=0,w=0;i-1<0?a=0:(this.game.world.tiles[i-1][l].creep>n||this.game.world.tiles[i-1][l].height>h)&&(a=1),i+1>this.game.world.dimensions.x-1?g=0:(this.game.world.tiles[i+1][l].creep>n||this.game.world.tiles[i+1][l].height>h)&&(g=1),l-1<0?m=0:(this.game.world.tiles[i][l-1].creep>n||this.game.world.tiles[i][l-1].height>h)&&(m=1),l+1>this.game.world.dimensions.y-1?w=0:(this.game.world.tiles[i][l+1].creep>n||this.game.world.tiles[i][l+1].height>h)&&(w=1);let S=8*w+4*a+2*m+g;const C=new y(new v(K,new N(S*16,0,16,16)));C.x=s*i,C.y=e*l,C.width=s,C.height=e,this.app.stage.addChild(C)}}}drawProjectile(s,e){const t=new f;for(let i of this.game.projectiles)t.beginFill(16711680),t.lineStyle(1,16711680),t.moveTo(i.pos.x*s,i.pos.y*e),t.lineTo(i.targetPos.x*s,i.targetPos.y*e),t.closePath(),t.endFill();this.app.stage.addChild(t)}drawPackets(s,e){const t=new f;for(let i of this.game.packets){switch(t.lineStyle(1,4210752),i.type){case p.Health:t.beginFill(8421504);break;case p.Energy:t.beginFill(16711680);break;default:console.log("Error new PacketType");break}t.drawCircle(i.pos.x*s,i.pos.y*e,4),t.endFill()}this.app.stage.addChild(t)}}var W=(r=>(r[r.Null=0]="Null",r[r.Collector=1]="Collector",r[r.Blaster=2]="Blaster",r))(W||{});class te{constructor(s){var e,t,i,l,h;this.canvasClick=n=>{let a=document.getElementById("canvas"),g=a.clientWidth/this.game.world.dimensions.x,m=a.clientHeight/this.game.world.dimensions.y,w=Math.floor((n.clientX-a.offsetLeft)/g),S=Math.floor((n.clientY-a.offsetTop)/m);this.gameClick(w,S)},this.handleCollectorClick=()=>{this.changeCurser(1)},this.handleBlasterClick=()=>{this.changeCurser(2)},this.pauseBtn=()=>{let n=document.getElementById("pause-btn");this.game.gameState===d.InGame?(this.game.gameState=d.Pause,n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pause" viewBox="0 0 16 16"> <path d="M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z" /> </svg>'):this.game.gameState===d.Pause&&(this.game.gameState=d.InGame,n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play" viewBox="0 0 16 16"> <path d="M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z" /> </svg>')},this.exitBtn=()=>{location.reload()},this.curserState=0,this.game=s,(e=document.getElementById("canvas"))==null||e.addEventListener("click",this.canvasClick),(t=document.getElementById("collector"))==null||t.addEventListener("click",this.handleCollectorClick),(i=document.getElementById("blaster"))==null||i.addEventListener("click",this.handleBlasterClick),(l=document.getElementById("pause-btn"))==null||l.addEventListener("click",this.pauseBtn),(h=document.getElementById("exit-btn"))==null||h.addEventListener("click",this.exitBtn)}gameClick(s,e){switch(this.curserState){case 0:this.selectOrMove({x:s,y:e});break;case 1:console.log("Try to place a Collector at "+s+" "+e),this.game.addBuilding(new o(s,e),c.Collector);break;case 2:console.log("Try to place a Blaster"),this.game.addBuilding(new o(s,e),c.Blaster);break}this.curserState=0}selectOrMove(s){let e=this.game.getBuildingAt(s);e?(console.log("Select building"),this.selectedBuilding=e):this.selectedBuilding?(console.log("Selected Building move"),this.selectedBuilding.status=u.Moving,this.selectedBuilding.moveTargetPos=s,this.selectedBuilding=void 0):console.log("Nothing todo here")}changeCurser(s){console.log("You are holding a "+W[s]),this.curserState=s}}class B{constructor(s,e){this.spawnCreeper=()=>{this.game.world.tiles[this.pos.x][this.pos.y].creep+=this.strength},this.game=e,this.pos=s,this.strength=25}}function ie(){let r=[[2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,3,3,3,3,3,3],[1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,1,1,1,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,3,3,3,3,3,3,3],[1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3],[1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,3,3,3,3,3,3,3,3,3,3],[1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,3,3,3,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,3,3,3,3,3,3,3,3,3,3,3],[1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,3,3,3,3,3,3,3,3,3,3,3,3],[1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3],[1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2],[2,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2],[1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2],[1,1,1,1,1,1,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,1,1,1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2],[1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2],[1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,1,1],[1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,1,1,1],[1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1],[2,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,3,3,3,3,3,3,2,2,2,2,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1],[2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,2,2,2,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,1,1,1,1,1,2,2,2,2,2,2,2,2,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,3,3,3,3,2,2,2,2,2,2,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2],[2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1],[3,3,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]];return r.toString=function(){let s=[];for(let e=1;e<48;e++)s.push("["+this[e].join(", ")+"]");return"["+s.join(`,
`)+`
];`},r}class se{constructor(){this.full=!1,this.collector=null,this.creep=0,this.newcreep=0,this.height=0}}class le{constructor(s){this.getHighestTile=e=>this.tiles[e.x][e.y].height,this.tiles=[],this.dimensions=s}createWorld(){this.tiles=new Array(this.dimensions.x);for(let e=0;e<this.dimensions.x;e++){this.tiles[e]=new Array(this.dimensions.y);for(let t=0;t<this.dimensions.y;t++)this.tiles[e][t]=new se}let s=ie();for(let e=0;e<this.dimensions.x;e++)for(let t=0;t<this.dimensions.y;t++){let i=s[t][e];i>6&&(i=6),this.tiles[e][t].height=i}}withinWorld(s,e){return s>-1&&s<this.dimensions.x&&e>-1&&e<this.dimensions.y}}class re{constructor(s){this.update=()=>{this.game.gameState===d.InGame?this.updateCreeper():console.log("not ingame")},this.updateCreeper=()=>{this.emitterCounter++,this.emitterCounter>=20&&(this.spawnInCreeper(),this.emitterCounter=0);for(let e=0;e<this.game.world.dimensions.x;e++)for(let t=0;t<this.game.world.dimensions.y;t++)this.game.world.tiles[e][t].newcreep=this.game.world.tiles[e][t].creep;if(this.creeperCounter++,this.creeperCounter>20){this.creeperCounter-=20;for(let e=0;e<this.game.world.dimensions.x;e++)for(let t=0;t<this.game.world.dimensions.y;t++)e+1<this.game.world.dimensions.x&&this.transferCreep(this.game.world.tiles[e][t],this.game.world.tiles[e+1][t]),e-1>-1&&this.transferCreep(this.game.world.tiles[e][t],this.game.world.tiles[e-1][t]),t+1<this.game.world.dimensions.y&&this.transferCreep(this.game.world.tiles[e][t],this.game.world.tiles[e][t+1]),t-1>-1&&this.transferCreep(this.game.world.tiles[e][t],this.game.world.tiles[e][t-1]);for(let e=0;e<this.game.world.dimensions.x;e++)for(let t=0;t<this.game.world.dimensions.y;t++)this.game.world.tiles[e][t].height+this.game.world.tiles[e][t].newcreep>=6?this.game.world.tiles[e][t].newcreep=6-this.game.world.tiles[e][t].height:this.game.world.tiles[e][t].newcreep<.04&&(this.game.world.tiles[e][t].newcreep=0),this.game.world.tiles[e][t].creep=this.game.world.tiles[e][t].newcreep}},this.transferCreep=(e,t)=>{let i=.2;if(e.height>-1&&t.height>-1&&e.creep>0){let l=e.height+e.creep,h=t.height+t.creep,n=0;if(l>h){n=l-h,n>e.creep&&(n=e.creep);let a=n*i;e.newcreep-=a,t.newcreep+=a}}},this.spawnInCreeper=()=>{for(let e=0;e<this.game.emitters.length;e++)this.game.emitters[e].spawnCreeper()},this.game=s,this.creeperCounter=0,this.emitterCounter=0,setInterval(this.update,1)}}class he{constructor(s){this.update=()=>{this.game.gameState===d.InGame?this.updateBuildings():console.log("not ingame")},this.updateBuildings=()=>{for(let e=0;e<this.game.buildings.length;e++){const t=this.game.buildings[e];t!==this.game.player&&t.requestPacket(),t instanceof b&&t.collectEnergy(),t instanceof H&&t.update(),t.move(),!(t instanceof E)&&t.status!=u.Moving&&t.takeDamage()}},this.game=s,setInterval(this.update,1e3)}}class ne{constructor(s){this.update=()=>{this.game.gameState===d.InGame?this.moveProjectiles():console.log("not ingame")},this.moveProjectiles=()=>{this.game.projectiles.forEach(e=>{e.remove?this.game.projectiles.delete(e):e.move(this.game)})},this.game=s,setInterval(this.update,100)}}class ae{constructor(s){this.update=()=>{this.game.gameState===d.InGame?this.movePackets():console.log("not ingame")},this.movePackets=()=>{this.game.packets.forEach(e=>{e.remove?this.game.packets.delete(e):e.move()})},this.game=s,setInterval(this.update,200)}}class j{constructor(){this.nodes=[],this.remove=!1,this.distanceTravelled=0,this.distanceRemaining=0}}class oe{constructor(s){this.update=()=>{this.game.gameState===d.InGame?this.sendPackets():console.log("not ingame")},this.sendPackets=()=>{for(let e=0;e<this.game.packetQueue.length;e++)if(this.game.player.energy>0){this.game.player.setEnergy(this.game.player.energy-1);let t=this.game.packetQueue.shift();t!==void 0&&this.game.packets.add(t)}},this.game=s,setInterval(this.update,100)}}class de{constructor(s){this.update=()=>{let e=!0;for(let t=0;t<this.game.buildings.length;t++)this.game.buildings[t]instanceof E&&this.game.buildings[t].health!==this.game.buildings[t].maxHealth&&(e=!1);e&&(this.game.gameState=d.Won,console.log("You have won the game")),this.game.player.health===0&&(this.game.gameState=d.Lost,console.log("You have lost the game"))},this.game=s,setInterval(this.update,1)}}class ge{constructor(){this.buildings=[],this.emitters=[],this.projectiles=new Set,this.packets=new Set,this.packetQueue=[],this.stabilizer=[],this.removeBuilding=s=>{this.buildings=this.buildings.filter(e=>e!==s),this.updateConnections(),s instanceof b&&s.built&&this.updateCollectionFields(s,T.Remove),this.packets.forEach(e=>{e.target===s&&this.packets.delete(e)}),this.packetQueue=this.packetQueue.filter(e=>e.target!==s)},this.findRoute=s=>{let e=[],t=new j;for(t.nodes.push(s.currentTarget),e.push(t);e.length>0&&e[0].nodes[e[0].nodes.length-1]!==s.target;){let i=e.shift(),l=i==null?void 0:i.nodes[i.nodes.length-1],h=this.getNeighbourBuildings(l,s.target);for(let n=0;n<h.length;n++)if(!this.inRoute(h[n],i==null?void 0:i.nodes)){let a=new j;a.nodes=Y(i==null?void 0:i.nodes),a.nodes.push(h[n]),a.distanceTravelled=i==null?void 0:i.distanceTravelled;let g=a.nodes[a.nodes.length-1].getCenter(),m=a.nodes[a.nodes.length-2].getCenter();a.distanceTravelled+=x(g,m);let w=s.target.getCenter();a.distanceRemaining=x(w,g),e.push(a)}for(let n=0;n<e.length;n++)for(let a=0;a<e.length;a++)n!==a&&e[n].nodes[e[n].nodes.length-1]===e[a].nodes[e[a].nodes.length-1]&&(e[n].distanceTravelled<e[a].distanceTravelled?e[a].remove=!0:e[n].distanceTravelled>e[a].distanceTravelled&&(e[n].remove=!0));for(let n=0;n<e.length;n++)e[n].remove&&e.splice(n,1);e.sort((n,a)=>n.distanceTravelled+n.distanceRemaining-(a.distanceTravelled+a.distanceRemaining))}e.length>0?s.currentTarget=e[0].nodes[1]:(s.currentTarget=null,s.type===p.Energy?(s.target.energyRequests--,s.target.energyRequests<0&&(s.target.energyRequests=0)):s.type===p.Health&&(s.target.healthRequests--,s.target.healthRequests<0&&(s.target.healthRequests=0)),s.remove=!0)},this.inRoute=(s,e)=>{let t=!1;for(let i=0;i<e.length;i++)if(s.pos.x===e[i].pos.x&&s.pos.y===e[i].pos.y){t=!0;break}return t},this.getBuildingAt=s=>{for(let e=0;e<this.buildings.length;e++){const t=this.buildings[e];if(s.x>=t.pos.x&&s.y>=t.pos.y&&s.x<t.pos.x+t.size&&s.y<t.pos.y+t.size)return t}},this.player=new M(40,36,this),this.world=new le({x:70,y:48}),this.world.createWorld(),this.emitters.push(new B(new o(0,0),this)),this.emitters.push(new B(new o(17,0),this)),this.emitters.push(new B(new o(35,0),this)),this.emitters.push(new B(new o(69,0),this)),this.buildings.push(this.player),this.addBuilding(new o(42,29),c.Collector),this.buildings[1].built=!0,this.buildings[1].health=this.buildings[1].maxHealth,this.addBuilding(new o(9,5),c.Stabilizer),this.addBuilding(new o(37,4),c.Stabilizer),this.addBuilding(new o(59,17),c.Stabilizer),this.gameState=d.InGame,new de(this),new re(this),new he(this),new ne(this),new oe(this),new ae(this)}addBuilding(s,e){let t=null;if(!this.buildingCanBePlaced(s)){console.log("building cant be placed");return}switch(e){case c.Collector:t=new b(s,this);break;case c.Blaster:t=new H(s,this);break;case c.Stabilizer:t=new E(s,this);break}t!==null&&(this.buildings.push(t),this.updateConnections(),console.log("new building has been placed at: "+s.x+" "+s.y))}getNeighbourBuildings(s,e){let t=[];for(let i=0;i<this.buildings.length;i++)if(!(s.pos.x===this.buildings[i].pos.x&&s.pos.y===this.buildings[i].pos.y)&&(this.buildings[i]===e||this.buildings[i].built||e===void 0)){let l=this.buildings[i].getCenter(),h=s.getCenter();x(h,l)<=5&&t.push(this.buildings[i])}return t}updateConnections(){let s=[];this.getAllConnections(this.player,s);for(let e=0;e<s.length;e++){const t=s[e];t instanceof b&&t.built&&this.updateCollectionFields(t,T.Add)}}getAllConnections(s,e){let t=this.getNeighbourBuildings(s);for(let i=0;i<t.length;i++)e.includes(t[i])||(e.push(t[i]),this.getAllConnections(t[i],e))}updateCollectionFields(s,e){let t=this.world.tiles[s.pos.x][s.pos.y].height;for(let i=-2;i<3;i++)for(let l=-2;l<3;l++){const h=new o(s.pos.x+i,s.pos.y+l);if(this.world.withinWorld(h.x,h.y)){const n=this.world.tiles[h.x][h.y].height;t===n&&(e===T.Add?this.world.tiles[h.x][h.y].collector=s:this.world.tiles[h.x][h.y].collector=null)}}}queuePacket(s,e){let t=new R(this.player.getCenter(),s,e,this);t.currentTarget=this.player,this.findRoute(t),t.currentTarget!==null&&(e===p.Health&&s.healthRequests++,e===p.Energy&&(s.energyRequests+=4),this.packetQueue.push(t))}buildingCanBePlaced(s){for(let e=0;e<this.buildings.length;e++){const t=this.buildings[e];if(s.x>=t.pos.x&&s.y>=t.pos.y&&s.x<t.pos.x+t.size&&s.y<t.pos.y+t.size)return!1}return!0}}class ce{constructor(s){var e;this.hover=t=>{let i=document.getElementById("canvas"),l=i.clientWidth/this.game.world.dimensions.x,h=i.clientHeight/this.game.world.dimensions.y,n=Math.floor((t.clientX-i.offsetLeft)/l),a=Math.floor((t.clientY-i.offsetTop)/h);this.updateProgressbar(new o(n,a))},this.updateProgressbar=t=>{let i=document.getElementById("elevation-terrain-progress"),l=this.game.world.tiles[t.x][t.y].height;i.style.width=(100/6*l).toString()+"%",i=document.getElementById("elevation-creeper-progress");let h=this.game.world.tiles[t.x][t.y].creep;i.style.width=(100/6*h).toString()+"%"},this.game=s,(e=document.getElementById("canvas"))==null||e.addEventListener("mousemove",this.hover)}}class pe{constructor(){this.offset={x:0,y:0},this.game=new ge,this.clickHandler=new te(this.game),new ce(this.game),new ee(this.game)}onClick(s){this.clickHandler.changeCurser(s)}}new pe;
